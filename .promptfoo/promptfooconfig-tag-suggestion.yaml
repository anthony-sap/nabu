# Tag Suggestion
# Test this prompt individually: npm run promptfoo:eval:tag-suggestion

description: "Tag Suggestion"

providers:
  - openai:gpt-4o-mini
  - openai:gpt-4o
  - openai:gpt-3.5-turbo

defaultTest:
  options:
    temperature: 0.7
    max_tokens: 100

prompts:
  - id: tag-suggestion
    raw: |
      [
        {
          "role": "system",
          "content": "You are a helpful assistant that suggests relevant tags for notes and thoughts."
        },
        {
          "role": "user",
          "content": "Analyze the following content and suggest 3-5 relevant tags for categorization.\n{{existing_tags_section}}\nRules:\n- Prioritize suggesting relevant tags from the user's existing tags when appropriate\n- Only suggest new tags if the existing tags don't adequately describe the content\n- Return tags as short phrases (1-3 words max)\n- Focus on: topics, themes, categories, projects\n- Make tags actionable and searchable\n- Return ONLY tag names, comma-separated\n- No explanations, no numbering\n\nContent:\n{{content}}\n\nTags:"
        }
      ]

tests:
  - vars:
      prompt: tag-suggestion
      existing_tags_section: |
        User's Existing Tags: work, project, meeting, customer, feedback, support, technical, bug, feature
      content: |
        Meeting notes from project kickoff. Discussed timeline, deliverables, and team assignments.
        Key decisions: Use React for frontend, Node.js for backend. Target launch date: Q1 2025.
    assert:
      - type: javascript
        value: |
          const tags = output.split(',').map(t => t.trim()).filter(t => t.length > 0);
          return tags.length >= 3 && tags.length <= 5;
        description: "Should suggest 3-5 tags"
      - type: javascript
        value: |
          const tags = output.split(',').map(t => t.trim());
          return tags.every(tag => tag.length > 0 && tag.length < 50);
        description: "Each tag should be 1-50 characters"
      - type: contains-any
        value: ["project", "meeting", "work"]
        transform: "lowercase"
        description: "Should prioritize existing relevant tags"

  - vars:
      prompt: tag-suggestion
      existing_tags_section: ""
      content: |
        Research findings on machine learning applications in healthcare.
        Key insights: Improved diagnostic accuracy by 15%, personalized treatment recommendations show promise.
    assert:
      - type: javascript
        value: |
          const tags = output.split(',').map(t => t.trim()).filter(t => t.length > 0);
          return tags.length >= 3 && tags.length <= 5;
        description: "Should suggest 3-5 tags"
      - type: contains-any
        value: ["machine learning", "healthcare", "research", "ml"]
        transform: "lowercase"
        description: "Should suggest relevant new tags"

output:
  path: .promptfoo/outputs

